// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE

import * as $$Map from "bs-platform/lib/es6/map.js";
import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as Caml_option from "bs-platform/lib/es6/caml_option.js";
import * as CrdtCore$DeltaCrdts from "./CrdtCore.bs.js";

function Make(Id) {
  var State = $$Map.Make(Id);
  var include = CrdtCore$DeltaCrdts.Make(State);
  var replicaGenerator = include.replicaGenerator;
  var value = function (patch) {
    return Curry._3(State.fold, (function (param, v, accum) {
                  return v + accum | 0;
                }), patch.state, 0);
  };
  var replica = Curry._1(replicaGenerator, 0);
  var increment = function (replica) {
    var id = replica.id;
    if (id === undefined) {
      return /* Invalid */Block.__(1, [replica]);
    }
    var state = replica.state;
    var id$1 = Caml_option.valFromOption(id);
    var newValue = Curry._2(State.find, id$1, state) + 1 | 0;
    var delta = Curry._3(State.add, id$1, newValue, State.empty);
    var state$1 = Curry._3(State.add, id$1, newValue, state);
    return /* Result */Block.__(0, [
              /* replica */{
                id: Caml_option.some(id$1),
                state: state$1
              },
              /* delta */{
                id: undefined,
                state: delta
              }
            ]);
  };
  return {
          State: State,
          replicaGenerator: replicaGenerator,
          join: include.join,
          value: value,
          replica: replica,
          increment: increment
        };
}

export {
  Make ,
  
}
/* No side effect */
